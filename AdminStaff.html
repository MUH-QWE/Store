<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS - Staff Control</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/AdminPanel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
</head>

<body>
    <div class="admin-container">
        <header class="admin-top-bar">
            <div class="sidebar-logo">
                <i class="fas fa-layer-group"></i>
                <span>NEXUS</span>
            </div>

            <nav class="admin-nav">
                <a href="index.html" class="nav-item"><i class="fas fa-globe"></i><span>Live Site</span></a>
                <a href="AdminDashboard.html" class="nav-item"><i
                        class="fas fa-tachometer-alt"></i><span>Management</span></a>
                <a href="#" class="nav-item active"><i class="fas fa-users-cog"></i><span>Staff Control</span></a>
                <a href="AdminComms.html" class="nav-item">
                    <i class="fas fa-envelope-open-text"></i>
                    <span>Comms</span>
                    <span class="nav-badge">0</span>
                </a>
            </nav>

            <div class="user-profile">
                <div class="avatar"><i class="fas fa-crown"></i></div>
                <div class="user-info">
                    <h4 id="admin-name" style="margin: 0; font-size: 0.8rem;">Master Admin</h4>
                </div>
                <button class="logout-btn" onclick="store.logout()" style="margin-left: 1rem; padding: 0.4rem 0.8rem;">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </header>

        <main class="main-content">


            <div class="content-grid stagger-2">
                <div class="panel-card">
                    <div class="panel-header">
                        <h3>Active Personnel</h3>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Entity</th>
                                    <th>Designation</th>
                                    <th>Access Level</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="staff-table-body">
                                <!-- Dynamics Staff Only -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="panel-card">
                    <div class="panel-header">
                        <h3 id="form-title">Induct New Agent</h3>
                    </div>
                    <form id="staff-form" class="terminal-form">
                        <div class="form-group">
                            <label>Full Legal Name</label>
                            <input type="text" name="name" id="staff-name-input" required placeholder="Enter name...">
                        </div>
                        <div class="form-group">
                            <label>Security Email</label>
                            <input type="email" name="email" id="staff-email-input" required
                                placeholder="agent@nexus.ops">
                        </div>
                        <div class="form-group">
                            <label>Access Credential (Password)</label>
                            <input type="password" name="password" id="staff-pass-input" required
                                placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label>Clearance Level</label>
                            <select name="role" id="staff-role-input" style="color: #000; background: #fff;">
                                <option value="junior">Level 1 (Junior - View Only)</option>
                                <option value="moderator">Level 2 (Moderator - Manage Assets)</option>
                                <option value="senior">Level 3 (Senior - Manage Comms)</option>
                                <option value="admin">Level 4 (Admin - Full Access)</option>
                            </select>
                        </div>
                        <input type="hidden" id="edit-staff-id" value="">
                        <button type="submit" class="btn-primary" id="staff-submit-btn">
                            <i class="fas fa-user-plus"></i> AUTHORIZE INDUCTION
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="js/ALL.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = store.getUser();
            if (!user || user.role !== 'admin') { window.location.href = 'LogIn.html'; return; }
            document.getElementById('admin-name').textContent = user.name;
            loadStaff();

            document.getElementById('staff-form').onsubmit = async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());
                const editId = document.getElementById('edit-staff-id').value;

                let staffList = JSON.parse(localStorage.getItem('nexus_staff') || '[]');

                if (editId) {
                    const idx = staffList.findIndex(s => s.id == editId);
                    staffList[idx] = { ...staffList[idx], ...data };
                    showNotification('Agent credentials modulated', 'success');
                } else {
                    data.id = Date.now();
                    staffList.push(data);
                    showNotification('New agent inducted into NEXUS', 'success');
                }

                localStorage.setItem('nexus_staff', JSON.stringify(staffList));
                e.target.reset();
                document.getElementById('edit-staff-id').value = "";
                document.getElementById('form-title').textContent = "Induct New Agent";
                document.getElementById('staff-submit-btn').innerHTML = '<i class="fas fa-user-plus"></i> AUTHORIZE INDUCTION';
                loadStaff();
            };
        });

        function loadStaff() {
            let staffList = JSON.parse(localStorage.getItem('nexus_staff') || '[]');

            const tbody = document.getElementById('staff-table-body');
            if (staffList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:2rem; color:var(--text-dim);">No active agents found in database</td></tr>';
                return;
            }
            tbody.innerHTML = staffList.map(s => `
                <tr>
                    <td><div class="avatar" style="width:35px;height:35px;font-size:0.8rem;">${s.name.substring(0, 2).toUpperCase()}</div></td>
                    <td><strong>${s.name}</strong><br><small style="color:var(--text-dim)">${s.email}</small></td>
                    <td><span style="color:${getRoleColor(s.role)}">${getRoleLabel(s.role)}</span></td>
                    <td><span class="status-badge">ACTIVE</span></td>
                    <td>
                        <div class="actions-row">
                            <button class="btn-mini" onclick="editStaff(${s.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn-mini delete" onclick="deleteStaff(${s.id})"><i class="fas fa-user-slash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getRoleLabel(role) {
            const roles = {
                'admin': 'Level 4 (Admin)',
                'senior': 'Level 3 (Senior)',
                'moderator': 'Level 2 (Moderator)',
                'junior': 'Level 1 (Junior)'
            };
            return roles[role] || role;
        }

        function getRoleColor(role) {
            const colors = {
                'admin': 'var(--primary)',
                'senior': 'var(--accent)',
                'moderator': 'var(--secondary)',
                'junior': 'var(--text-dim)'
            };
            return colors[role] || '#fff';
        }

        window.deleteStaff = (id) => {
            if (!confirm('TERMINATE AGENT ACCESS?')) return;
            let staffList = JSON.parse(localStorage.getItem('nexus_staff') || '[]');
            staffList = staffList.filter(s => s.id != id);
            localStorage.setItem('nexus_staff', JSON.stringify(staffList));
            loadStaff();
            showNotification('Agent access terminated', 'error');
        };

        window.editStaff = (id) => {
            let staffList = JSON.parse(localStorage.getItem('nexus_staff') || '[]');
            const s = staffList.find(item => item.id == id);

            document.getElementById('staff-name-input').value = s.name;
            document.getElementById('staff-email-input').value = s.email;
            document.getElementById('staff-pass-input').value = s.password;
            document.getElementById('staff-role-input').value = s.role;
            document.getElementById('edit-staff-id').value = s.id;

            document.getElementById('form-title').textContent = "Modulate Agent Credentials";
            document.getElementById('staff-submit-btn').innerHTML = '<i class="fas fa-save"></i> COMMIT MODULATION';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
    </script>
</body>

</html>