<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TAYEB DJERBA</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/AdminPanel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="gradient-overlay"></div>

    <div class="admin-container">

        <aside class="sidebar fade-in">
            <div class="sidebar-header">
                <h2><i class="fas fa-microchip"></i> <span class="text-gradient">NEXUS</span> OPS</h2>
                <div class="user-info">
                    <div class="user-avatar"><i class="fas fa-user-shield"></i></div>
                    <div>
                        <span id="admin-name">Administrator</span>
                        <small>Level 1 Access</small>
                    </div>
                </div>
            </div>
            <nav class="admin-nav">
                <a href="#" class="nav-item active"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
                <a href="Products.html" class="nav-item"><i class="fas fa-box"></i><span>Inventory</span><span
                        class="badge" id="total-products-stat">0</span></a>
                <a href="AdminPanel.html" class="nav-item"><i
                        class="fas fa-shopping-cart"></i><span>Transmissions</span><span class="badge"
                        id="total-orders-stat">0</span></a>
                <a href="#" class="nav-item"><i class="fas fa-users"></i><span>Subscribers</span><span class="badge"
                        id="total-customers-stat">0</span></a>
                <a href="#" class="nav-item"><i class="fas fa-chart-bar"></i><span>Analytics</span></a>
                <a href="#" class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a>
            </nav>
            <div class="sidebar-footer">
                <button id="logout-btn" class="logout-btn" onclick="store.logout()"><i
                        class="fas fa-sign-out-alt"></i><span>Terminate Session</span></button>
            </div>
        </aside>

        <main class="main-content">
            <header class="content-header fade-in stagger-1">
                <div class="header-title">
                    <h1>Command <span class="text-gradient">Overview</span></h1>
                    <p>Welcome back, <span id="admin-name-header">Admin</span></p>
                </div>
                <div class="header-actions">
                    <button id="refresh-btn" class="btn-action" onclick="location.reload()"><i
                            class="fas fa-sync-alt"></i> SYNC</button>
                    <button id="export-btn" class="btn-action"><i class="fas fa-download"></i> EXPORT</button>
                </div>
            </header>

            <div class="stats-grid fade-in stagger-2">
                <div class="stat-card" data-type="products">
                    <div class="stat-icon"><i class="fas fa-boxes"></i></div>
                    <div class="stat-info">
                        <h3>Total Inventory</h3>
                        <span class="stat-value" id="total-products">0</span>
                    </div>
                </div>
                <div class="stat-card" data-type="orders">
                    <div class="stat-icon"><i class="fas fa-shopping-cart"></i></div>
                    <div class="stat-info">
                        <h3>Active Transmissions</h3>
                        <span class="stat-value" id="total-orders">0</span>
                    </div>
                </div>
                <div class="stat-card" data-type="customers">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-info">
                        <h3>Identified Entities</h3>
                        <span class="stat-value" id="total-customers">1,240</span>
                    </div>
                </div>
            </div>

            <div class="content-grid fade-in stagger-3">
                <div class="content-card">
                    <div class="card-header">
                        <h3>Inventory Management</h3>
                    </div>

                    <div class="filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="product-search" placeholder="Filter protocols...">
                        </div>
                        <div class="filter-controls">
                            <select id="category-filter">
                                <option value="all">All Sectors</option>
                                <option value="oil">Olive Oil</option>
                                <option value="ceramics">Ceramics</option>
                                <option value="textiles">Textiles</option>
                            </select>
                            <select id="sort-products">
                                <option value="newest">Latest First</option>
                                <option value="price-asc">Price: Low-High</option>
                                <option value="price-desc">Price: High-Low</option>
                            </select>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Protocol Name</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">

                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="side-panel">
                    <div class="content-card">
                        <h3>Initialize New Protocol</h3>
                        <form id="add-product-form">
                            <div class="form-group">
                                <label>Protocol Name</label>
                                <input type="text" name="name" required placeholder="Enter protocol name">
                            </div>
                            <div class="form-group">
                                <label>Price (EGP)</label>
                                <input type="number" name="price" step="0.01" min="0" required placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Sector</label>
                                <select name="category" required>
                                    <option value="oil">Olive Oil</option>
                                    <option value="ceramics">Ceramics</option>
                                    <option value="textiles">Textiles</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Reference Image URL</label>
                                <input type="text" name="image" placeholder="https://..." required>
                            </div>
                            <div class="form-group">
                                <label>Protocol Description</label>
                                <textarea name="description" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn-submit"><i class="fas fa-plus-circle"></i> ADD TO
                                INVENTORY</button>
                        </form>
                    </div>

                    <div class="content-card">
                        <h3>Recent Transmissions</h3>
                        <div id="recent-orders" class="orders-list">

                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="dashboard-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span id="modal-close" class="close-btn"
                onclick="document.getElementById('dashboard-modal').style.display='none'">&times;</span>
            <h2 id="modal-title">Protocol Details</h2>
            <div id="modal-body">Processing metadata...</div>
        </div>
    </div>

    <script src="js/ALL.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            LuxeApp.init();
            window.adminPanel = new AdminPanel();

            const user = store.getUser();
            if (!user || user.role !== 'admin') {
                window.location.href = 'LogIn.html';
                return;
            }

            document.getElementById('admin-name').textContent = user.name;
            document.getElementById('admin-name-header').textContent = user.name;

            initDashboard();
        });

        async function initDashboard() {
            const products = await api.get('/products/get.php');
            const orders = await api.get('/orders/get_all.php');

            renderProducts(products);
            renderStats(products, orders);
            renderRecentOrders(orders);

            document.getElementById('add-product-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());

                showNotification('Protocol initialized: ' + data.name, 'success');
                e.target.reset();
            });
        }

        function renderProducts(products) {
            const tbody = document.getElementById('products-table-body');
            tbody.innerHTML = products.map(p => `
                <tr>
                    <td><img src="${p.image}" class="product-img-td"></td>
                    <td>${p.name}</td>
                    <td><span class="text-gradient" style="font-weight: 700;">${p.price.toFixed(2)} EGP</span></td>
                    <td>
                        <div class="actions-cell">
                            <button class="btn-icon" onclick="viewDetails(${p.id})"><i class="fas fa-eye"></i></button>
                            <button class="btn-icon delete" onclick="showNotification('Operation restricted in demo mode', 'error')"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');

            document.getElementById('total-products-stat').textContent = products.length;
            document.getElementById('total-products').textContent = products.length;
        }

        function renderStats(products, orders) {
            document.getElementById('total-orders-stat').textContent = orders.length;
            document.getElementById('total-orders').textContent = orders.length;

            document.getElementById('total-customers-stat').textContent = '240';
        }

        function renderRecentOrders(orders) {
            const container = document.getElementById('recent-orders');
            container.innerHTML = orders.slice(0, 5).map(o => `
                <div class="order-mini-card">
                    <div class="order-mini-info">
                        <h4>#${o.id} - ${o.user}</h4>
                        <p>${o.status}</p>
                    </div>
                    <div class="order-mini-price">${o.total.toFixed(2)} EGP</div>
                </div>
            `).join('');
        }

        window.viewDetails = async (id) => {
            const modal = document.getElementById('dashboard-modal');
            const body = document.getElementById('modal-body');
            const title = document.getElementById('modal-title');
            modal.style.display = 'flex';

            const product = await api.get('/products/get_single.php?id=' + id);
            title.textContent = "Metadata: " + product.name;
            body.innerHTML = `
                <div style="display: flex; gap: 2rem;">
                    <img src="${product.image}" style="width: 150px; border-radius: 16px;">
                    <div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">${product.description}</p>
                        <p>Valuation: <span class="text-gradient" style="font-weight: 700; font-size: 1.5rem;">${product.price.toFixed(2)} EGP</span></p>
                    </div>
                </div>
            `;
        }
    </script>
</body>

</html>